{% extends "layout.html" %}

{% block content %}
<div style="padding: 40px; max-width: 800px; margin: 0 auto;">
    
    <h2 style="margin-bottom: 30px; color: #333;">
        {% if product %} Edit Product ✏️ {% else %} Add New Product ➕ {% endif %}
    </h2>

    <form method="POST" style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
        
        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: bold;">Product Name</label>
            <input type="text" name="name" value="{{ product.name if product else '' }}" required 
                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
        </div>

        <div style="display: flex; gap: 20px; margin-bottom: 20px;">
            <div style="flex: 1;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Price ($)</label>
                <input type="number" step="0.01" name="price" value="{{ product.price if product else '' }}" required 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            <div style="flex: 1;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold;">Stock Quantity</label>
                <input type="number" name="stock_quantity" value="{{ product.stock_quantity if product else '' }}" required 
                       style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: bold;">Category</label>
            <input list="categories_list" name="category" value="{{ product.category if product else '' }}" required 
                   placeholder="Select or type new..."
                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            
            <datalist id="categories_list">
                {% for cat in categories %}
                    <option value="{{ cat }}">
                {% endfor %}
            </datalist>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 8px; font-weight: bold;">Image URL</label>
            <input type="text" name="image_url" value="{{ product.image_url if product else '' }}" required 
                   placeholder="https://example.com/image.jpg"
                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
        </div>

        <div style="margin-bottom: 30px; border-top: 1px solid #eee; padding-top: 20px;">
            <label style="display: block; margin-bottom: 10px; font-weight: bold;">Product Details (Specs)</label>
            
            <div id="details-container">
                {% if product and product.details %}
                    {% for key, value in product.details.items() %}
                    <div class="detail-row" style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="text" name="detail_key[]" value="{{ key }}" placeholder="Key (e.g. Color)" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <input type="text" name="detail_val[]" value="{{ value }}" placeholder="Value (e.g. Red)" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        <button type="button" onclick="removeRow(this)" style="background: #fee; color: red; border: 1px solid red; border-radius: 5px; cursor: pointer;">X</button>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>

            <button type="button" onclick="addDetailRow()" style="background: #eef2ff; color: var(--primary-color); border: 1px dashed var(--primary-color); padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-top: 5px;">
                + Add Spec
            </button>
        </div>

        <button type="submit" style="background: var(--primary-color); color: white; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
            {% if product %} Update Product {% else %} Create Product {% endif %}
        </button>
        
        <a href="{{ url_for('admin.manage_products') }}" style="margin-left: 15px; color: #666; text-decoration: none;">Cancel</a>
    </form>
</div>

<script>
    function addDetailRow() {
        const container = document.getElementById('details-container');
        const div = document.createElement('div');
        div.className = 'detail-row';
        div.style.cssText = 'display: flex; gap: 10px; margin-bottom: 10px;';
        div.innerHTML = `
            <input type="text" name="detail_key[]" placeholder="Key (e.g. Brand)" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
            <input type="text" name="detail_val[]" placeholder="Value (e.g. Sony)" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
            <button type="button" onclick="removeRow(this)" style="background: #fee; color: red; border: 1px solid red; border-radius: 5px; cursor: pointer;">X</button>
        `;
        container.appendChild(div);
    }

    function removeRow(btn) {
        btn.parentElement.remove();
    }
    
    window.onload = function() {
        const container = document.getElementById('details-container');
        if (container.children.length === 0) {
            addDetailRow();
        }
    };
</script>
{% endblock %}